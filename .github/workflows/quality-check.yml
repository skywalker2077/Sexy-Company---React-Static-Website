name: Code Quality Checks

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  quality-checks:
    name: Code Quality & Linting
    runs-on: ubuntu-latest
    
    steps:
    - name: üì• Checkout repository
      uses: actions/checkout@v4
      
    - name: üü¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'
        
    - name: üì¶ Install dependencies
      run: npm ci
      
    - name: üîç TypeScript type checking
      run: |
        echo "Running TypeScript type checking..."
        npx tsc --noEmit --pretty
      continue-on-error: true
      
    - name: üìä Check bundle size
      run: |
        echo "Building and analyzing bundle size..."
        npm run build
        
        echo "üì¶ Build artifacts:"
        find build/static -name "*.js" -o -name "*.css" | while read file; do
          size=$(stat -f%z "$file" 2>/dev/null || stat -c%s "$file" 2>/dev/null || echo "0")
          echo "  $(basename "$file"): ${size} bytes"
        done
        
    - name: üßπ Check for common issues
      run: |
        echo "Checking for potential issues..."
        
        # Verificar se h√° console.log em produ√ß√£o
        if grep -r "console\.log" src/ --include="*.ts" --include="*.tsx" --include="*.js" --include="*.jsx"; then
          echo "‚ö†Ô∏è Warning: Found console.log statements in source code"
        else
          echo "‚úÖ No console.log statements found"
        fi
        
        # Verificar se h√° TODOs ou FIXMEs
        if grep -r "TODO\|FIXME" src/ --include="*.ts" --include="*.tsx" --include="*.js" --include="*.jsx"; then
          echo "üìù Found TODO/FIXME comments"
        else
          echo "‚úÖ No pending TODO/FIXME items"
        fi
        
        # Verificar tamanhos de arquivos CSS
        echo "üìè CSS file sizes:"
        find src/ -name "*.css" | while read file; do
          lines=$(wc -l < "$file")
          echo "  $(basename "$file"): ${lines} lines"
        done