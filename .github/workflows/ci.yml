name: Continuous Integration

# Workflow mais simples para CI bÃ¡sico
on:
  push:
    branches: [ main, master, develop ]
  pull_request:
    branches: [ main, master ]

jobs:
  test-and-build:
    name: Test and Build
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'
        
    - name: ğŸ“¦ Install dependencies
      run: |
        echo "Installing project dependencies..."
        npm ci
        
    - name: ğŸ” Check project structure
      run: |
        echo "Project structure:"
        ls -la
        echo "Package.json scripts:"
        npm run --silent
        
    - name: ğŸ—ï¸ Build project
      run: |
        echo "Starting build process..."
        npm run build
        echo "Build completed successfully!"
        
    - name: âœ… Verify build output
      run: |
        echo "Verifying build artifacts..."
        if [ -d "build" ]; then
          echo "âœ… Build directory exists"
          echo "Build contents:"
          ls -la build/
          
          if [ -f "build/index.html" ]; then
            echo "âœ… index.html found"
          else
            echo "âŒ index.html not found"
            exit 1
          fi
          
          if [ -d "build/static" ]; then
            echo "âœ… Static assets directory found"
            echo "Static files:"
            find build/static -type f -name "*.js" -o -name "*.css" | head -5
          else
            echo "âŒ Static assets directory not found"
            exit 1
          fi
          
          # Verificar tamanho do build
          BUILD_SIZE=$(du -sh build/ | cut -f1)
          echo "ğŸ“ Build size: $BUILD_SIZE"
          
        else
          echo "âŒ Build directory not found"
          exit 1
        fi
        
        echo "ğŸ‰ All build verifications passed!"

  # Job para verificar se nÃ£o hÃ¡ vulnerabilidades crÃ­ticas
  security-audit:
    name: Security Audit
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'
        
    - name: ğŸ“¦ Install dependencies
      run: npm ci
      
    - name: ğŸ”’ Run security audit
      run: |
        echo "Running security audit..."
        npm audit --audit-level high
      continue-on-error: true