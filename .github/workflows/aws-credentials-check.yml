name: AWS Credentials Check

on:
  workflow_dispatch:

jobs:
  test-aws:
    name: Test AWS Connection
    runs-on: ubuntu-latest
    
    steps:
    - name: 🔍 Test AWS Credentials
      env:
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        AWS_DEFAULT_REGION: us-east-1
      run: |
        echo "🔧 Testing AWS credentials..."
        
        if aws sts get-caller-identity; then
          echo ""
          echo "✅ SUCCESS: AWS credentials working!"
          echo ""
          aws sts get-caller-identity --output table
        else
          echo ""
          echo "❌ FAILED: Check your AWS credentials"
          exit 1
        fi
        
    - name: 🪣 Test S3 Access
      env:
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        AWS_DEFAULT_REGION: us-east-1
      run: |
        echo "🪣 Testing S3 access..."
        BUCKET_NAME="sexy-company"
        
        # List buckets
        echo "Available buckets:"
        aws s3 ls
        echo ""
        
        # Test bucket access
        if aws s3 ls s3://$BUCKET_NAME/ 2>/dev/null; then
          echo "✅ Bucket '$BUCKET_NAME' exists and is accessible"
        else
          echo "ℹ️ Bucket '$BUCKET_NAME' not found, will create it"
          if aws s3 mb s3://$BUCKET_NAME --region us-east-1; then
            echo "✅ Bucket created successfully!"
          else
            echo "⚠️ Could not create bucket (may exist in another account)"
          fi
        fi
        
        # Test write permission
        echo "test" > test.txt
        if aws s3 cp test.txt s3://$BUCKET_NAME/test.txt; then
          echo "✅ Write permission: OK"
          aws s3 rm s3://$BUCKET_NAME/test.txt
          echo "✅ Cleanup: OK"
        else
          echo "❌ Write permission: FAILED"
        fi
        
    - name: 🎉 Success Summary
      run: |
        echo ""
        echo "🎉 AWS Test Complete!"
        echo "===================="
        echo "✅ AWS Credentials: Working"
        echo "✅ S3 Access: OK"
        echo "✅ Bucket: Ready"
        echo ""
        echo "🚀 Ready for deployment!"